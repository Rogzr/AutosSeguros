<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Comparador de Seguros - Carga de PDFs</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header class="site-header">
    <h1>Comparador de Seguros</h1>
    <p class="subtitle">HDI Seguros Â· Qualitas Â· ANA Seguros Â· Seguros Atlas</p>
  </header>

  <main class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-container">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <section class="card">
      <h2>Sube tus cotizaciones en PDF</h2>
      <p>Archivos soportados: {{ supported_companies | join(', ') }}</p>
      <ul class="hints">
        <li>Acepta mÃºltiples archivos</li>
        <li>Los datos se procesan en tiempo real</li>
        <li>Exporta el comparativo a PDF</li>
      </ul>

      <form id="uploadForm" action="{{ url_for('process') }}" method="post" enctype="multipart/form-data">
        <div id="dropzone" class="dropzone">
          <input id="fileInput" type="file" name="files" accept="application/pdf" multiple>
          <div class="dropzone-content">
            <div class="drop-icon">ðŸ“„</div>
            <div class="drop-text">
              Arrastra y suelta tus PDFs aquÃ­ o haz clic para seleccionar
            </div>
          </div>
        </div>
        <div id="fileList" class="file-list"></div>
        <div class="actions">
          <button type="submit" class="btn primary">Procesar</button>
        </div>
      </form>

      <div class="notes">
        <p><strong>Landing AI:</strong> {{ 'Activo' if landing_ai_available else 'No disponible' }}</p>
        <p><strong>WeasyPrint:</strong> {{ 'Disponible' if weasyprint_available else 'No disponible (se exportarÃ¡ HTML)' }}</p>
      </div>
    </section>
  </main>

  <footer class="site-footer">&copy; {{ 2025 }} Comparador de Seguros</footer>

  <script>
    (function() {
      const dropzone = document.getElementById('dropzone');
      const fileInput = document.getElementById('fileInput');
      const fileList = document.getElementById('fileList');

      function renderFiles(files) {
        fileList.innerHTML = '';
        Array.from(files).forEach(f => {
          const item = document.createElement('div');
          item.className = 'file-item';
          item.textContent = f.name;
          fileList.appendChild(item);
        });
      }

      dropzone.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', () => renderFiles(fileInput.files));

      ['dragenter','dragover'].forEach(evt => dropzone.addEventListener(evt, e => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.add('dragging');
      }));
      ['dragleave','drop'].forEach(evt => dropzone.addEventListener(evt, e => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.remove('dragging');
      }));
      dropzone.addEventListener('drop', e => {
        const dt = e.dataTransfer;
        if (!dt) return;
        fileInput.files = dt.files;
        renderFiles(fileInput.files);
      });
    })();
  </script>
</body>
</html>


